# 登录流程


***
### 1. 客户端使用http来访问认证服务器的认证接口, 返回accountid和token
	url: http://127.0.0.1:7777/auth
	data: {"channel":1,"account":"lori227"}
	
	data数据根据channel不同而不同, 上面是1 内部测试渠道. 代码中有实现微信(2)登录渠道接口
	认证成功返回
	{
		"accountid" : 500001,
		"retcode" : 1,
		"serverlist" : 
		[
			{
				"id" : 1,
				"ip" : "192.168.1.9",
				"name" : "内网测试服",
				"port" : 12055,
				"type" : 101
			},
		],
		"serverlisttype" : 1,
		"token" : "5e05ebf54401878ce2dd8d9f129334e4"
	}
	失败通过retcode返回错误码

	serverlisttype 服务器列表类型 1 返回所有可登录的服务器列表 2 只返回可登录的一个服务器ip和port

### 2. 客户端选择一个服务器, 使用ip和port连接gate. 
	连接成功以后, 发送 MsgLoginVerifyReq 登录验证消息

### 3. gate收到MsgLoginVerifyReq消息
	处理客户端连接信息, 选择一个login发送S2SLoginLoginVerifyReq消息

### 4. login收到S2SLoginLoginVerifyReq消息
	将数据通过http发送到auth认证服务器, 认证token的有效性.
	失败通过retcode返回错误码
	如果成功会玩家的playerid
	验证成功, 发送S2SLoginWorldVerifyReq到world
### 5. world收到S2SLoginWorldVerifyReq消息
	踢掉在线玩家, 如果玩家在线返回错误
	选择一个game发送消息S2SLoginTellTokenToGameReq消息
### 6. game收到S2SLoginTellTokenToGameReq消息
	踢掉当前服务器的角色信息
	发送S2SLoginLoadPlayerReq到data集群, 加载玩家数据
### 7. datashard收到S2SLoginLoadPlayerReq消息
	其中消息经过dataproxy转发, 如果有异常可以查询日志
	datashard加载玩家数据, 返回S2SLoginLoadPlayerAck消息到game
### 8. game收到S2SLoginLoadPlayerAck消息
	创建角色, 并初始化玩家数据.
	发送S2SLoginGameAck到玩家连接的gate
### 9. gate收到S2SLoginGameAck消息
	如果登录失败, 发送错误码, 并断开连接
	绑定玩家playerid到网络
	创建role信息, 保存连接数据
	发送MsgEnterGame到客户端
### 10. 客户端收到MsgEnterGame消息
	解析数据, 玩家进入游戏世界, 完成登录